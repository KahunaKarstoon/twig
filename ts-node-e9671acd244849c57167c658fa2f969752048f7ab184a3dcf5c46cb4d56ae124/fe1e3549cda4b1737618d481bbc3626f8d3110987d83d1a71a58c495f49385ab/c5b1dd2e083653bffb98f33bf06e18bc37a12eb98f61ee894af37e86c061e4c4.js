"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var protractor_1 = require("protractor");
var app_po_1 = require("../PageObjects/app.po");
describe('Model Lifecycle', function () {
    var page;
    var modelName = 'Test Model';
    beforeAll(function () {
        page = new app_po_1.TwigPage();
        page.navigateTo();
        page.user.loginDefaultTestUser();
        page.header.modelTab.deleteModelIfNeeded(modelName, page);
        protractor_1.browser.waitForAngular();
    });
    afterAll(function () {
        // browser.manage().logs().get('browser').then(function(browserLog) {
        //   console.log('log: ' + require('util').inspect(browserLog));
        // });
    });
    describe('Create a Model', function () {
        beforeAll(function () {
            page.header.goToTab('Model');
        });
        it('pops up the create model modal when the button is pressed', function () {
            page.header.modelTab.startNewModelProcess();
            expect(page.formForModals.modalTitle).toEqual('Create New Model');
        });
        it('does not start out showing any form errors', function () {
            expect(page.formForModals.formErrorCount).toEqual(0);
        });
        it('displays an error if the name is empty', function () {
            page.formForModals.makeInputFieldDirtyByLabel('Name');
            expect(page.formForModals.getErrorByLabel('Name')).toEqual('You must enter a name for your model!');
        });
        it('removes the error if a value is put into the name field', function () {
            page.formForModals.fillInTextFieldByLabel('Name', modelName);
            expect(page.formForModals.getErrorByLabel('Name')).toBeUndefined();
        });
        it('should enable the "Create" button once the minimum is filled out', function () {
            expect(page.formForModals.checkIfButtonEnabled('Create')).toBeTruthy();
        });
        it('should close the modal when the submit button is pressed', function () {
            page.formForModals.clickButton('Create');
            protractor_1.browser.waitForAngular();
            page.formForModals.waitForModalToClose();
            expect(page.formForModals.isModalOpen).toBeFalsy();
        });
        it('should allow us to edit the model', function () {
            page.header.modelEditTab.startModelEditProcess();
            expect(page.modelEditForm.isOpen).toBeTruthy();
        });
        it('should start with no entities', function () {
            expect(page.modelEditForm.entityCount).toEqual(0);
        });
        it('allows the user to add an entity', function () {
            page.modelEditForm.addEntity('zzzzz', 'dollar', '#008800');
            page.modelEditForm.addAttribute(1, 'attr1', 'String', false);
            expect(page.modelEditForm.entityCount).toEqual(1);
        });
        it('adds new entities to the top of the form', function () {
            page.modelEditForm.addEntity('aaaaa', 'car', '#880088');
            expect(page.modelEditForm.row[2].type).toEqual('zzzzz');
        });
        it('allows the user to remove an entity', function () {
            page.modelEditForm.clickButton('fa-trash');
            expect(page.modelEditForm.entityCount).toEqual(1);
        });
        it('can save the model', function () {
            page.modelEditForm.saveModelEdits();
            page.formForModals.fillInOnlyTextField('Test Model Created');
            page.formForModals.clickButton('Save Changes');
            protractor_1.browser.waitForAngular();
            expect(page.modelInfo.entityCount).toEqual(1);
        });
    });
    describe('Editing Models', function () {
        it('can start the editing process', function () {
            page.modelEditForm.startEditing();
            expect(page.modelEditForm.isOpen).toBeTruthy();
        });
        it('can add an entity', function () {
            page.modelEditForm.startAddingEntity();
            expect(page.modelEditForm.entityCount).toEqual(2);
        });
        it('makes the form invalid when initially adding an entity', function () {
            expect(page.modelEditForm.isReadyToSave).toBeFalsy();
        });
        it('can fill in the type but that is not enough to make the form valid', function () {
            page.modelEditForm.row[1].type = 'aaaaaa';
            expect(page.modelEditForm.isReadyToSave).toBeFalsy();
        });
        it('can fill in the icon and with the type that is enough to make the form valid', function () {
            page.modelEditForm.row[1].icon = 'bug';
            expect(page.modelEditForm.isReadyToSave).toBeTruthy();
        });
        var attribute;
        it('adding an attribute makes the form invalid again', function () {
            page.modelEditForm.startAddingAttribute(1).then(function (rs) { return attribute = rs; });
            expect(page.modelEditForm.isReadyToSave).toBeFalsy();
        });
        it('attribute name is not enough to make the form valid', function () {
            attribute.name = 'attr1';
            expect(page.modelEditForm.isReadyToSave).toBeFalsy();
        });
        it('filling in the name and the type is enough to make the form valid', function () {
            attribute.type = 'String';
            expect(page.modelEditForm.isReadyToSave).toBeTruthy();
        });
        it('can save the changes', function () {
            page.modelEditForm.saveModelEdits();
            page.formForModals.fillInOnlyTextField('Making some changes');
            page.formForModals.clickButton('Save Changes');
            protractor_1.browser.waitForAngular();
            expect(page.modelInfo.entityCount).toEqual(2);
        });
    });
    describe('Deleting Models', function () {
        beforeAll(function () {
            page = new app_po_1.TwigPage();
            page.navigateTo();
        });
        it('can bring up the delete model modal', function () {
            page.header.modelTab.startDeleteModelProcess(modelName);
            expect(page.formForModals.modalTitle).toEqual("Delete " + modelName);
        });
        it('disables the "Delete" button if the name does not match', function () {
            expect(page.formForModals.checkIfButtonEnabled('Delete')).toBeFalsy();
        });
        it('enables the button if the form is filled out correctly', function () {
            page.formForModals.fillInOnlyTextField(modelName);
            expect(page.formForModals.checkIfButtonEnabled('Delete')).toBeTruthy();
        });
        it('should close the modal when the Delete button is pressed', function () {
            page.formForModals.clickButton('Delete');
            page.formForModals.waitForModalToClose();
            expect(page.formForModals.isModalOpen).toBeFalsy();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL3R3aWcvZTJlL2pvdXJuZXlzL21vZGVsLmUyZS1zcGVjLnRzIiwic291cmNlcyI6WyIvdHdpZy9lMmUvam91cm5leXMvbW9kZWwuZTJlLXNwZWMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSx5Q0FBOEM7QUFFOUMsZ0RBQWlEO0FBRWpELFFBQVEsQ0FBQyxpQkFBaUIsRUFBRTtJQUMxQixJQUFJLElBQWMsQ0FBQztJQUNuQixJQUFNLFNBQVMsR0FBRyxZQUFZLENBQUM7SUFFL0IsU0FBUyxDQUFDO1FBQ1IsSUFBSSxHQUFHLElBQUksaUJBQVEsRUFBRSxDQUFDO1FBQ3RCLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUNsQixJQUFJLENBQUMsSUFBSSxDQUFDLG9CQUFvQixFQUFFLENBQUM7UUFDakMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsbUJBQW1CLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQzFELG9CQUFPLENBQUMsY0FBYyxFQUFFLENBQUM7SUFDM0IsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUM7UUFDUCxxRUFBcUU7UUFDckUsZ0VBQWdFO1FBQ2hFLE1BQU07SUFDUixDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxnQkFBZ0IsRUFBRTtRQUN6QixTQUFTLENBQUM7WUFDUixJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUMvQixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywyREFBMkQsRUFBRTtZQUM5RCxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxvQkFBb0IsRUFBRSxDQUFDO1lBQzVDLE1BQU0sQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLFVBQVUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1FBQ3BFLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDRDQUE0QyxFQUFFO1lBQy9DLE1BQU0sQ0FBQyxJ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QzdELElBQUksQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3pDLElBQUksQ0FBQyxhQUFhLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztZQUN6QyxNQUFNLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUNyRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBicm93c2VyLCBlbGVtZW50IH0gZnJvbSAncHJvdHJhY3Rvcic7XG5cbmltcG9ydCB7IFR3aWdQYWdlIH0gZnJvbSAnLi4vUGFnZU9iamVjdHMvYXBwLnBvJztcblxuZGVzY3JpYmUoJ01vZGVsIExpZmVjeWNsZScsICgpID0+IHtcbiAgbGV0IHBhZ2U6IFR3aWdQYWdlO1xuICBjb25zdCBtb2RlbE5hbWUgPSAnVGVzdCBNb2RlbCc7XG5cbiAgYmVmb3JlQWxsKCgpID0+IHtcbiAgICBwYWdlID0gbmV3IFR3aWdQYWdlKCk7XG4gICAgcGFnZS5uYXZpZ2F0ZVRvKCk7XG4gICAgcGFnZS51c2VyLmxvZ2luRGVmYXVsdFRlc3RVc2VyKCk7XG4gICAgcGFnZS5oZWFkZXIubW9kZWxUYWIuZGVsZXRlTW9kZWxJZk5lZWRlZChtb2RlbE5hbWUsIHBhZ2UpO1xuICAgIGJyb3dzZXIud2FpdEZvckFuZ3VsYXIoKTtcbiAgfSk7XG5cbiAgYWZ0ZXJBbGwoKCkgPT4ge1xuICAgIC8vIGJyb3dzZXIubWFuYWdlKCkubG9ncygpLmdldCgnYnJvd3NlcicpLnRoZW4oZnVuY3Rpb24oYnJvd3NlckxvZykge1xuICAgIC8vICAgY29uc29sZS5sb2coJ2xvZzogJyArIHJlcXVpcmUoJ3V0aWwnKS5pbnNwZWN0KGJyb3dzZXJMb2cpKTtcbiAgICAvLyB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0NyZWF0ZSBhIE1vZGVsJywgKCkgPT4ge1xuICAgIGJlZm9yZUFsbCgoKSA9PiB7XG4gICAgICBwYWdlLmhlYWRlci5nb1RvVGFiKCdNb2RlbCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3BvcHMgdXAgdGhlIGNyZWF0ZSBtb2RlbCBtb2RhbCB3aGVuIHRoZSBidXR0b24gaXMgcHJlc3NlZCcsICgpID0+IHtcbiAgICAgIHBhZ2UuaGVhZGVyLm1vZGVsVGFiLnN0YXJ0TmV3TW9kZWxQcm9jZXNzKCk7XG4gICAgICBleHBlY3QocGFnZS5mb3JtRm9yTW9kYWxzLm1vZGFsVGl0bGUpLnRvRXF1YWwoJ0NyZWF0ZSBOZXcgTW9kZWwnKTtcbiAgICB9KTtcblxuICAgIGl0KCdkb2VzIG5vdCBzdGFydCBvdXQgc2hvd2luZyBhbnkgZm9ybSBlcnJvcnMnLCAoKSA9PiB7XG4gICAgICBleHBlY3QocGFnZS5mb3JtRm9yTW9kYWxzLmZvcm1FcnJvckNvdW50KS50b0VxdWFsKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ2Rpc3BsYXlzIGFuIGVycm9yIGlmIHRoZSBuYW1lIGlzIGVtcHR5JywgKCkgPT4ge1xuICAgICAgcGFnZS5mb3JtRm9yTW9kYWxzLm1ha2VJbnB1dEZpZWxkRGlydHlCeUxhYmVsKCdOYW1lJyk7XG4gICAgICBleHBlY3QocGFnZS5mb3JtRm9yTW9kYWxzLmdldEVycm9yQnlMYWJlbCgnTmFtZScpKS50b0VxdWFsKCdZb3UgbXVzdCBlbnRlciBhIG5hbWUgZm9yIHlvdXIgbW9kZWwhJyk7XG4gICAgfSk7XG5cbiAgICBpdCgncmVtb3ZlcyB0aGUgZXJyb3IgaWYgYSB2YWx1ZSBpcyBwdXQgaW50byB0aGUgbmFtZSBmaWVsZCcsICgpID0+IHtcbiAgICAgIHBhZ2UuZm9ybUZvck1vZGFscy5maWxsSW5UZXh0RmllbGRCeUxhYmVsKCdOYW1lJywgbW9kZWxOYW1lKTtcbiAgICAgIGV4cGVjdChwYWdlLmZvcm1Gb3JNb2RhbHMuZ2V0RXJyb3JCeUxhYmVsKCdOYW1lJykpLnRvQmVVbmRlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZW5hYmxlIHRoZSBcIkNyZWF0ZVwiIGJ1dHRvbiBvbmNlIHRoZSBtaW5pbXVtIGlzIGZpbGxlZCBvdXQnLCAoKSA9PiB7XG4gICAgICBleHBlY3QocGFnZS5mb3JtRm9yTW9kYWxzLmNoZWNrSWZCdXR0b25FbmFibGVkKCdDcmVhdGUnKSkudG9CZVRydXRoeSgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjbG9zZSB0aGUgbW9kYWwgd2hlbiB0aGUgc3VibWl0IGJ1dHRvbiBpcyBwcmVzc2VkJywgKCkgPT4ge1xuICAgICAgcGFnZS5mb3JtRm9yTW9kYWxzLmNsaWNrQnV0dG9uKCdDcmVhdGUnKTtcbiAgICAgIGJyb3dzZXIud2FpdEZvckFuZ3VsYXIoKTtcbiAgICAgIHBhZ2UuZm9ybUZvck1vZGFscy53YWl0Rm9yTW9kYWxUb0Nsb3NlKCk7XG4gICAgICBleHBlY3QocGFnZS5mb3JtRm9yTW9kYWxzLmlzTW9kYWxPcGVuKS50b0JlRmFsc3koKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYWxsb3cgdXMgdG8gZWRpdCB0aGUgbW9kZWwnLCAoKSA9PiB7XG4gICAgICBwYWdlLmhlYWRlci5tb2RlbEVkaXRUYWIuc3RhcnRNb2RlbEVkaXRQcm9jZXNzKCk7XG4gICAgICBleHBlY3QocGFnZS5tb2RlbEVkaXRGb3JtLmlzT3BlbikudG9CZVRydXRoeSgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBzdGFydCB3aXRoIG5vIGVudGl0aWVzJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KHBhZ2UubW9kZWxFZGl0Rm9ybS5lbnRpdHlDb3VudCkudG9FcXVhbCgwKTtcbiAgICB9KTtcblxuICAgIGl0KCdhbGxvd3MgdGhlIHVzZXIgdG8gYWRkIGFuIGVudGl0eScsICgpID0+IHtcbiAgICAgIHBhZ2UubW9kZWxFZGl0Rm9ybS5hZGRFbnRpdHkoJ3p6enp6JywgJ2RvbGxhcicsICcjMDA4ODAwJyk7XG4gICAgICBwYWdlLm1vZGVsRWRpdEZvcm0uYWRkQXR0cmlidXRlKDEsICdhdHRyMScsICdTdHJpbmcnLCBmYWxzZSk7XG4gICAgICBleHBlY3QocGFnZS5tb2RlbEVkaXRGb3JtLmVudGl0eUNvdW50KS50b0VxdWFsKDEpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2FkZHMgbmV3IGVudGl0aWVzIHRvIHRoZSB0b3Agb2YgdGhlIGZvcm0nLCAoKSA9PiB7XG4gICAgICBwYWdlLm1vZGVsRWRpdEZvcm0uYWRkRW50aXR5KCdhYWFhYScsICdjYXInLCAnIzg4MDA4OCcpO1xuICAgICAgZXhwZWN0KHBhZ2UubW9kZWxFZGl0Rm9ybS5yb3dbMl0udHlwZSkudG9FcXVhbCgnenp6enonKTtcbiAgICB9KTtcblxuICAgIGl0KCdhbGxvd3MgdGhlIHVzZXIgdG8gcmVtb3ZlIGFuIGVudGl0eScsICgpID0+IHtcbiAgICAgIHBhZ2UubW9kZWxFZGl0Rm9ybS5jbGlja0J1dHRvbignZmEtdHJhc2gnKTtcbiAgICAgIGV4cGVjdChwYWdlLm1vZGVsRWRpdEZvcm0uZW50aXR5Q291bnQpLnRvRXF1YWwoMSk7XG4gICAgfSk7XG5cbiAgICBpdCgnY2FuIHNhdmUgdGhlIG1vZGVsJywgKCkgPT4ge1xuICAgICAgcGFnZS5tb2RlbEVkaXRGb3JtLnNhdmVNb2RlbEVkaXRzKCk7XG4gICAgICBwYWdlLmZvcm1Gb3JNb2RhbHMuZmlsbEluT25seVRleHRGaWVsZCgnVGVzdCBNb2RlbCBDcmVhdGVkJyk7XG4gICAgICBwYWdlLmZvcm1Gb3JNb2RhbHMuY2xpY2tCdXR0b24oJ1NhdmUgQ2hhbmdlcycpO1xuICAgICAgYnJvd3Nlci53YWl0Rm9yQW5ndWxhcigpO1xuICAgICAgZXhwZWN0KHBhZ2UubW9kZWxJbmZvLmVudGl0eUNvdW50KS50b0VxdWFsKDEpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRWRpdGluZyBNb2RlbHMnLCAoKSA9PiB7XG4gICAgaXQoJ2NhbiBzdGFydCB0aGUgZWRpdGluZyBwcm9jZXNzJywgKCkgPT4ge1xuICAgICAgcGFnZS5tb2RlbEVkaXRGb3JtLnN0YXJ0RWRpdGluZygpO1xuICAgICAgZXhwZWN0KHBhZ2UubW9kZWxFZGl0Rm9ybS5pc09wZW4pLnRvQmVUcnV0aHkoKTtcbiAgICB9KTtcblxuICAgIGl0KCdjYW4gYWRkIGFuIGVudGl0eScsICgpID0+IHtcbiAgICAgIHBhZ2UubW9kZWxFZGl0Rm9ybS5zdGFydEFkZGluZ0VudGl0eSgpO1xuICAgICAgZXhwZWN0KHBhZ2UubW9kZWxFZGl0Rm9ybS5lbnRpdHlDb3VudCkudG9FcXVhbCgyKTtcbiAgICB9KTtcblxuICAgIGl0KCdtYWtlcyB0aGUgZm9ybSBpbnZhbGlkIHdoZW4gaW5pdGlhbGx5IGFkZGluZyBhbiBlbnRpdHknLCAoKSA9PiB7XG4gICAgICBleHBlY3QocGFnZS5tb2RlbEVkaXRGb3JtLmlzUmVhZHlUb1NhdmUpLnRvQmVGYWxzeSgpO1xuICAgIH0pXG5cbiAgICBpdCgnY2FuIGZpbGwgaW4gdGhlIHR5cGUgYnV0IHRoYXQgaXMgbm90IGVub3VnaCB0byBtYWtlIHRoZSBmb3JtIHZhbGlkJywgKCkgPT4ge1xuICAgICAgcGFnZS5tb2RlbEVkaXRGb3JtLnJvd1sxXS50eXBlID0gJ2FhYWFhYSc7XG4gICAgICBleHBlY3QocGFnZS5tb2RlbEVkaXRGb3JtLmlzUmVhZHlUb1NhdmUpLnRvQmVGYWxzeSgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2NhbiBmaWxsIGluIHRoZSBpY29uIGFuZCB3aXRoIHRoZSB0eXBlIHRoYXQgaXMgZW5vdWdoIHRvIG1ha2UgdGhlIGZvcm0gdmFsaWQnLCAoKSA9PiB7XG4gICAgICBwYWdlLm1vZGVsRWRpdEZvcm0ucm93WzFdLmljb24gPSAnYnVnJztcbiAgICAgIGV4cGVjdChwYWdlLm1vZGVsRWRpdEZvcm0uaXNSZWFkeVRvU2F2ZSkudG9CZVRydXRoeSgpO1xuICAgIH0pO1xuXG4gICAgbGV0IGF0dHJpYnV0ZTogeyBuYW1lOiBzdHJpbmcsIHR5cGU6IHN0cmluZywgcmVxdWlyZWQ6IGJvb2xlYW4gfTtcblxuICAgIGl0KCdhZGRpbmcgYW4gYXR0cmlidXRlIG1ha2VzIHRoZSBmb3JtIGludmFsaWQgYWdhaW4nLCAoKSA9PiB7XG4gICAgICBwYWdlLm1vZGVsRWRpdEZvcm0uc3RhcnRBZGRpbmdBdHRyaWJ1dGUoMSkudGhlbihycyA9PiBhdHRyaWJ1dGUgPSBycyk7XG4gICAgICBleHBlY3QocGFnZS5tb2RlbEVkaXRGb3JtLmlzUmVhZHlUb1NhdmUpLnRvQmVGYWxzeSgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2F0dHJpYnV0ZSBuYW1lIGlzIG5vdCBlbm91Z2ggdG8gbWFrZSB0aGUgZm9ybSB2YWxpZCcsICgpID0+IHtcbiAgICAgIGF0dHJpYnV0ZS5uYW1lID0gJ2F0dHIxJztcbiAgICAgIGV4cGVjdChwYWdlLm1vZGVsRWRpdEZvcm0uaXNSZWFkeVRvU2F2ZSkudG9CZUZhbHN5KCk7XG4gICAgfSk7XG5cbiAgICBpdCgnZmlsbGluZyBpbiB0aGUgbmFtZSBhbmQgdGhlIHR5cGUgaXMgZW5vdWdoIHRvIG1ha2UgdGhlIGZvcm0gdmFsaWQnLCAoKSA9PiB7XG4gICAgICBhdHRyaWJ1dGUudHlwZSA9ICdTdHJpbmcnO1xuICAgICAgZXhwZWN0KHBhZ2UubW9kZWxFZGl0Rm9ybS5pc1JlYWR5VG9TYXZlKS50b0JlVHJ1dGh5KCk7XG4gICAgfSk7XG5cbiAgICBpdCgnY2FuIHNhdmUgdGhlIGNoYW5nZXMnLCAoKSA9PiB7XG4gICAgICBwYWdlLm1vZGVsRWRpdEZvcm0uc2F2ZU1vZGVsRWRpdHMoKTtcbiAgICAgIHBhZ2UuZm9ybUZvck1vZGFscy5maWxsSW5Pbmx5VGV4dEZpZWxkKCdNYWtpbmcgc29tZSBjaGFuZ2VzJyk7XG4gICAgICBwYWdlLmZvcm1Gb3JNb2RhbHMuY2xpY2tCdXR0b24oJ1NhdmUgQ2hhbmdlcycpO1xuICAgICAgYnJvd3Nlci53YWl0Rm9yQW5ndWxhcigpO1xuICAgICAgZXhwZWN0KHBhZ2UubW9kZWxJbmZvLmVudGl0eUNvdW50KS50b0VxdWFsKDIpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRGVsZXRpbmcgTW9kZWxzJywgKCkgPT4ge1xuICAgIGJlZm9yZUFsbCgoKSA9PiB7XG4gICAgICBwYWdlID0gbmV3IFR3aWdQYWdlKCk7XG4gICAgICBwYWdlLm5hdmlnYXRlVG8oKTtcbiAgICB9KTtcblxuICAgIGl0KCdjYW4gYnJpbmcgdXAgdGhlIGRlbGV0ZSBtb2RlbCBtb2RhbCcsICgpID0+IHtcbiAgICAgIHBhZ2UuaGVhZGVyLm1vZGVsVGFiLnN0YXJ0RGVsZXRlTW9kZWxQcm9jZXNzKG1vZGVsTmFtZSk7XG4gICAgICBleHBlY3QocGFnZS5mb3JtRm9yTW9kYWxzLm1vZGFsVGl0bGUpLnRvRXF1YWwoYERlbGV0ZSAke21vZGVsTmFtZX1gKTtcbiAgICB9KTtcblxuICAgIGl0KCdkaXNhYmxlcyB0aGUgXCJEZWxldGVcIiBidXR0b24gaWYgdGhlIG5hbWUgZG9lcyBub3QgbWF0Y2gnLCAoKSA9PiB7XG4gICAgICBleHBlY3QocGFnZS5mb3JtRm9yTW9kYWxzLmNoZWNrSWZCdXR0b25FbmFibGVkKCdEZWxldGUnKSkudG9CZUZhbHN5KCk7XG4gICAgfSk7XG5cbiAgICBpdCgnZW5hYmxlcyB0aGUgYnV0dG9uIGlmIHRoZSBmb3JtIGlzIGZpbGxlZCBvdXQgY29ycmVjdGx5JywgKCkgPT4ge1xuICAgICAgcGFnZS5mb3JtRm9yTW9kYWxzLmZpbGxJbk9ubHlUZXh0RmllbGQobW9kZWxOYW1lKTtcbiAgICAgIGV4cGVjdChwYWdlLmZvcm1Gb3JNb2RhbHMuY2hlY2tJZkJ1dHRvbkVuYWJsZWQoJ0RlbGV0ZScpKS50b0JlVHJ1dGh5KCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNsb3NlIHRoZSBtb2RhbCB3aGVuIHRoZSBEZWxldGUgYnV0dG9uIGlzIHByZXNzZWQnLCAoKSA9PiB7XG4gICAgICBwYWdlLmZvcm1Gb3JNb2RhbHMuY2xpY2tCdXR0b24oJ0RlbGV0ZScpO1xuICAgICAgcGFnZS5mb3JtRm9yTW9kYWxzLndhaXRGb3JNb2RhbFRvQ2xvc2UoKTtcbiAgICAgIGV4cGVjdChwYWdlLmZvcm1Gb3JNb2RhbHMuaXNNb2RhbE9wZW4pLnRvQmVGYWxzeSgpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl19